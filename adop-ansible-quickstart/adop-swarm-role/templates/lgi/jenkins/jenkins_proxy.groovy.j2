import jenkins.model.*

def instance = Jenkins.getInstance()
println "Configuring Jenkins proxy"

final String name = "{{ proxy_url.split('://')[1].split(':')[0] }}"
final int port = {{ proxy_url.split(':')[2] }}
final String userName = ""
final String password = ""
final String noProxyHost = "{{ no_proxy_hosts }}"
final String testUrl = "http://google.com"

final def pc = new hudson.ProxyConfiguration(name, port, userName, password, noProxyHost, testUrl)
instance.proxy = pc
instance.save()
println "Proxy settings updated!"
